// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Enums
enum GameStatus {
  SCHEDULED
  LIVE
  FINISHED
}

enum ActionType {
  TWO_PT_MAKE
  TWO_PT_MISS
  THREE_PT_MAKE
  THREE_PT_MISS
  FT_MAKE
  FT_MISS
  REB
  AST
  STL
  BLK
  FOUL
  TO
  SUB_IN
  SUB_OUT
}

enum Position {
  PG
  SG
  SF
  PF
  C
}

// Models
model Team {
  id        String   @id @default(uuid())
  name      String
  logoUrl   String?
  players   Player[]
  homeGames Game[]   @relation("HomeTeam")
  awayGames Game[]   @relation("AwayTeam")
}

model Player {
  id           String             @id @default(uuid())
  name         String
  jerseyNumber Int
  position     Position
  teamId       String
  team         Team               @relation(fields: [teamId], references: [id])
  actions      Action[]
  gameStatuses PlayerGameStatus[]

  @@index([teamId])
}

model Game {
  id                  String             @id @default(uuid())
  homeTeamId          String
  awayTeamId          String
  status              GameStatus         @default(SCHEDULED)
  scoreHome           Int                @default(0)
  scoreAway           Int                @default(0)
  summary             String?            @db.Text
  timerElapsedSeconds Int                @default(600) // Game timer in seconds (starts at 10:00)
  timerIsRunning      Boolean            @default(false) // Is timer currently running
  timerLastUpdatedAt  DateTime?          // Last time timer was updated
  createdAt           DateTime           @default(now())
  homeTeam            Team               @relation("HomeTeam", fields: [homeTeamId], references: [id])
  awayTeam            Team               @relation("AwayTeam", fields: [awayTeamId], references: [id])
  actions             Action[]
  playerStatuses      PlayerGameStatus[]
}

model Action {
  id             String     @id @default(uuid())
  gameId         String
  playerId       String
  type           ActionType
  quarter        Int
  elapsedSeconds Int?       // Game time when action occurred (0-600 seconds)
  locationX      Int?       // Court x-coordinate (0-100) for shot actions
  locationY      Int?       // Court y-coordinate (0-100) for shot actions
  createdAt      DateTime   @default(now())
  game           Game       @relation(fields: [gameId], references: [id])
  player         Player     @relation(fields: [playerId], references: [id])

  @@index([gameId, createdAt(sort: Desc)])
  @@index([playerId])
}

model PlayerGameStatus {
  id                 String   @id @default(uuid())
  gameId             String
  playerId           String
  isOnCourt          Boolean  @default(false)
  isStarter          Boolean  @default(false)
  totalSecondsPlayed Int      @default(0) // Total playing time in seconds
  lastSubInTime      Int? // Timer value when player last entered court (null if on bench)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  game               Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  player             Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([gameId, playerId])
  @@index([gameId])
  @@index([playerId])
}
